/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
/**
 * Author:  slon
 * Created: 24/05/2018
 */

-- ----------------- TABLA DE ASIENTOS -----------------
CREATE TABLE ASIENTOS(
   ASIENTO INT NOT NULL,
   NUMERO VARCHAR(3) NOT NULL,
   ESTADO CHAR NOT NULL,
   VUELO INT NULL,
   CONSTRAINT PK_ASIENTO PRIMARY KEY (ASIENTO),
   CONSTRAINT FK_ASIENTO_VUELO FOREIGN KEY (VUELO)
   REFERENCES VUELOS (VUELO)
);

CREATE SEQUENCE ASIENTOS_SEQ START WITH 1;

CREATE OR REPLACE TRIGGER ASIENTOS_AI 
BEFORE INSERT ON ASIENTOS 
FOR EACH ROW
BEGIN
  SELECT ASIENTOS_SEQ.NEXTVAL
  INTO   :new.ASIENTO
  FROM   dual;
END;
/

-- ----------------- INSERTAR ASIENTO ----------------- 
CREATE OR REPLACE PROCEDURE INSERTAR_ASIENTO(
ASIENTO IN ASIENTOS.ASIENTO%TYPE, 
NUMERO IN ASIENTOS.NUMERO%TYPE,
ESTADO IN ASIENTOS.ESTADO%TYPE,
VUELO IN ASIENTOS.VUELO%TYPE)
AS
BEGIN
    INSERT INTO ASIENTOS VALUES(ASIENTO, NUMERO, ESTADO, VUELO);
END;
/

-- ----------------- BUSCAR ASIENTO ----------------- 
CREATE OR REPLACE FUNCTION BUSCAR_ASIENTO(ASIENTOIN IN ASIENTOS.ASIENTO%TYPE)
RETURN TYPES.REF_CURSOR 
AS 
       ASIENTO_CURSOR TYPES.REF_CURSOR; 
BEGIN 
  OPEN ASIENTO_CURSOR FOR 
       SELECT * FROM ASIENTOS WHERE ASIENTO=ASIENTOIN; 
RETURN ASIENTO_CURSOR; 
END;
/


-- ----------------- LISTAR ASIENTOS ----------------- 
CREATE OR REPLACE FUNCTION LISTAR_ASIENTOS
RETURN TYPES.REF_CURSOR  
AS 
       ASIENTO_CURSOR TYPES.REF_CURSOR; 
BEGIN 
  OPEN ASIENTO_CURSOR FOR 
       SELECT * FROM ASIENTOS; 
RETURN ASIENTO_CURSOR; 
END;
/