/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
/**
 * Author:  slon
 * Created: 24/05/2018
 */

-- ----------------- TABLA DE RUTAS -----------------
CREATE TABLE RUTAS(
   RUTA INT NOT NULL,
   ORIGEN VARCHAR(20) NOT NULL,
   DESTINO VARCHAR(20) NOT NULL,
   DURACION VARCHAR(6) NOT NULL,
   CONT_COMPRA INT NOT NULL,
   DESCUENTO INT NULL,
   CONSTRAINT PK_RUTA PRIMARY KEY (RUTA),
   CONSTRAINT FK_RUTA_ORIGEN FOREIGN KEY (ORIGEN)
   REFERENCES LUGARES (NOMBRE),
   CONSTRAINT FK_RUTA_DESTINO FOREIGN KEY (DESTINO)
   REFERENCES LUGARES (NOMBRE)
);

-- ----------------- INSERTAR RUTAS ----------------- 
CREATE OR REPLACE PROCEDURE INSERTAR_RUTA(
RUTA IN RUTAS.RUTA%TYPE, 
ORIGEN IN RUTAS.ORIGEN%TYPE,
DESTINO IN RUTAS.DESTINO%TYPE,
DURACION IN RUTAS.DURACION%TYPE,
CONT_COMPRA IN RUTAS.CONT_COMPRA%TYPE,
DESCUENTO IN RUTAS.DESCUENTO%TYPE)
AS
BEGIN
    INSERT INTO RUTAS VALUES(RUTA, ORIGEN, DESTINO, DURACION, 
CONT_COMPRA, DESCUENTO);
END;
/

-- ----------------- ACTUALIZAR RUTA ----------------- 
CREATE OR REPLACE PROCEDURE ACTUALIZAR_RUTA(
RUTAIN IN RUTAS.RUTA%TYPE, 
ORIGENIN IN RUTAS.ORIGEN%TYPE,
DESTINOIN IN RUTAS.DESTINO%TYPE,
DURACIONIN IN RUTAS.DURACION%TYPE,
CONT_COMPRAIN IN RUTAS.CONT_COMPRA%TYPE,
DESCUENTOIN IN RUTAS.DESCUENTO%TYPE)
AS
BEGIN
    UPDATE RUTAS SET RUTA=RUTAIN, ORIGEN=ORIGENIN, DESTINO=DESTINOIN,
DURACION=DURACIONIN, CONT_COMPRA=CONT_COMPRAIN, DESCUENTO=DESCUENTOIN
WHERE RUTA=RUTAIN;
END;
/

-- ----------------- BUSCAR RUTA ----------------- 
CREATE OR REPLACE FUNCTION BUSCAR_RUTA(RUTAIN IN RUTAS.RUTA%TYPE)
RETURN TYPES.REF_CURSOR 
AS 
        RUTA_CURSOR TYPES.REF_CURSOR; 
BEGIN 
  OPEN RUTA_CURSOR FOR 
       SELECT * FROM RUTAS WHERE RUTA=RUTAIN; 
RETURN RUTA_CURSOR; 
END;
/

-- ----------------- LISTAR RUTAS ----------------- 
CREATE OR REPLACE FUNCTION LISTAR_RUTAS
RETURN TYPES.REF_CURSOR  
AS 
       RUTA_CURSOR TYPES.REF_CURSOR; 
BEGIN 
  OPEN RUTA_CURSOR FOR 
       SELECT * FROM RUTAS; 
RETURN RUTA_CURSOR; 
END;
/


Execute INSERTAR_RUTA(1, 'Santiago', 'Bogota', '6:00', 1, 0);
Execute INSERTAR_RUTA(2, 'Santiago', 'Ottawa', '10:00', 1, 0);
Execute INSERTAR_RUTA(3, 'Santiago', 'Ciudad de Mexico', '8:30', 1, 0);
Execute INSERTAR_RUTA(4, 'Santiago', 'Nueva York', '9:15', 1, 0);

Execute INSERTAR_RUTA(5, 'Ottawa', 'Rio de Janeiro', '9:00', 1, 0);
Execute INSERTAR_RUTA(6, 'Ottawa', 'Nueva York', '0:40', 1, 0);
Execute INSERTAR_RUTA(7, 'Ottawa', 'Bogota', '5:30', 1, 0);